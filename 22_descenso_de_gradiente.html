<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Decenso de Gradiente – Métodos Numéricos y Probabilidades 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-9eb995e8644016eb670a0cb3bf478a26.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Métodos Numéricos y Probabilidades 2025</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">Acerca de</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-unidad-1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Unidad 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-unidad-1">    
        <li>
    <a class="dropdown-item" href="./01_funcionamiento_cpu.html">
 <span class="dropdown-text">Funcionamiento de la CPU</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02_python.html">
 <span class="dropdown-text">Repaso de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_numpy_arrays.html">
 <span class="dropdown-text">Repaso de numpy, matplotlib, archivos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04_numeros_y_condicionamiento.html">
 <span class="dropdown-text">Representación de números y condicionamiento</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05_algoritmos_y_estabilidad.html">
 <span class="dropdown-text">Algoritmos y estabilidad</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-unidad-2" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Unidad 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-unidad-2">    
        <li>
    <a class="dropdown-item" href="./06_definicion_probabilidad.html">
 <span class="dropdown-text">Propiedades de la probabilidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07_distribuciones.html">
 <span class="dropdown-text">Distribuciones de probabilidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./08_varias_variables_aleatorias.html">
 <span class="dropdown-text">Varias variables aleatorias</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09_teorema_central_del_limite.html">
 <span class="dropdown-text">Teorema central del límite</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10_entropia.html">
 <span class="dropdown-text">Entropía de Shannon</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-unidad-3" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Unidad 3</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-unidad-3">    
        <li>
    <a class="dropdown-item" href="./11_solucion_sistemas_lineales.html">
 <span class="dropdown-text">Solución de Sistemas de Ecuaciones Lineales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12_newton_y_biseccion.html">
 <span class="dropdown-text">Solución de Ecuaciones No Lineales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13_interpolacion.html">
 <span class="dropdown-text">Interpolación</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./14_integracion_numerica.html">
 <span class="dropdown-text">Integración Numérica</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./15_integrales_multiples_impropias_y_gauss.html">
 <span class="dropdown-text">Quadratura de Gauss, integrales múltiples e impropias</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./16_derivadas.html">
 <span class="dropdown-text">Derivadas numéricas</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-unidad-4" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Unidad 4</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-unidad-4">    
        <li>
    <a class="dropdown-item" href="./17_metodos_de_taylor.html">
 <span class="dropdown-text">Métodos de Taylor</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./18_runge_kutta.html">
 <span class="dropdown-text">Métodos de Runge-Kutta</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./19_metodos_de_multiples_pasos.html">
 <span class="dropdown-text">Métodos de Múltiples Pasos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./20_edo_alto_orden_estabilidad.html">
 <span class="dropdown-text">Ecuaciones de alto orden y estabilidad</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-unidad-5" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Unidad 5</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-unidad-5">    
        <li>
    <a class="dropdown-item" href="./21_ajuste_de_curvas.html">
 <span class="dropdown-text">Ajustes de mínimos cuadrados</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./22_descenso_de_gradiente.html">
 <span class="dropdown-text">Descenso de gradiente</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./23_redes_neuronales.html">
 <span class="dropdown-text">Redes neuronales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./24_integracion_monte_carlo.html">
 <span class="dropdown-text">Integración de Monte Carlo</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./25_transformada_de_fourier.html">
 <span class="dropdown-text">Transformada de Fourier</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./21_ajuste_de_curvas.html">Unidad 5: Tópicos</a></li><li class="breadcrumb-item"><a href="./22_descenso_de_gradiente.html">Descenso de gradiente</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 1: Introducción</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_funcionamiento_cpu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Funcionamiento de la CPU</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Repaso de Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_numpy_arrays.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Repaso de numpy, matplotlib, archivos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_numeros_y_condicionamiento.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Representación de números y condicionamiento</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_algoritmos_y_estabilidad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Algoritmos y estabilidad</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 2: Probabilidad</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_definicion_probabilidad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Propiedades de la probabilidad</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_distribuciones.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distribuciones de probabilidad</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_varias_variables_aleatorias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Varias variables aleatorias</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_teorema_central_del_limite.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Teorema central del límite</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_entropia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Entropía de Shannon</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 3: Cálculo Numérico</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_solucion_sistemas_lineales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solución de Sistemas de Ecuaciones Lineales</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_newton_y_biseccion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solución de Ecuaciones No Lineales</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_interpolacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interpolación</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_integracion_numerica.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Integración Numérica</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_integrales_multiples_impropias_y_gauss.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quadratura de Gauss, integrales múltiples e impropias</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_derivadas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Derivadas numéricas</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 4: Ecuaciones Diferenciales</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_metodos_de_taylor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Métodos de Taylor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_runge_kutta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Métodos de Runge-Kutta</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_metodos_de_multiples_pasos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Métodos de Múltiples Pasos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_edo_alto_orden_estabilidad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ecuaciones de alto orden y estabilidad</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 5: Tópicos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_ajuste_de_curvas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ajustes de mínimos cuadrados</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_descenso_de_gradiente.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Descenso de gradiente</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_redes_neuronales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Redes neuronales</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24_integracion_monte_carlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Integración de Monte Carlo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_transformada_de_fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transformada de Fourier</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">En esta página</h2>
   
  <ul>
  <li><a href="#introducción-a-jax" id="toc-introducción-a-jax" class="nav-link active" data-scroll-target="#introducción-a-jax">Introducción a JAX</a>
  <ul class="collapse">
  <li><a href="#ventajas-de-jax" id="toc-ventajas-de-jax" class="nav-link" data-scroll-target="#ventajas-de-jax">Ventajas de JAX</a></li>
  <li><a href="#trabajando-con-arrays-de-jax" id="toc-trabajando-con-arrays-de-jax" class="nav-link" data-scroll-target="#trabajando-con-arrays-de-jax">Trabajando con arrays de JAX</a></li>
  <li><a href="#diferenciación-automática-con-grad" id="toc-diferenciación-automática-con-grad" class="nav-link" data-scroll-target="#diferenciación-automática-con-grad">Diferenciación automática con <code>grad</code></a></li>
  <li><a href="#acelerar-código-con-jit" id="toc-acelerar-código-con-jit" class="nav-link" data-scroll-target="#acelerar-código-con-jit">Acelerar código con JIT</a></li>
  </ul></li>
  <li><a href="#descenso-de-gradiente" id="toc-descenso-de-gradiente" class="nav-link" data-scroll-target="#descenso-de-gradiente">Descenso de gradiente</a>
  <ul class="collapse">
  <li><a href="#minimización" id="toc-minimización" class="nav-link" data-scroll-target="#minimización">Minimización</a></li>
  </ul></li>
  <li><a href="#mejoras-al-descenso-de-gradiente" id="toc-mejoras-al-descenso-de-gradiente" class="nav-link" data-scroll-target="#mejoras-al-descenso-de-gradiente">Mejoras al descenso de gradiente</a>
  <ul class="collapse">
  <li><a href="#momentum" id="toc-momentum" class="nav-link" data-scroll-target="#momentum">Momentum</a></li>
  <li><a href="#rmsprop" id="toc-rmsprop" class="nav-link" data-scroll-target="#rmsprop">RMSProp</a></li>
  <li><a href="#adam" id="toc-adam" class="nav-link" data-scroll-target="#adam">Adam</a></li>
  </ul></li>
  <li><a href="#usando-flax" id="toc-usando-flax" class="nav-link" data-scroll-target="#usando-flax">Usando Flax</a></li>
  <li><a href="#tareas" id="toc-tareas" class="nav-link" data-scroll-target="#tareas">¡Tareas!</a>
  <ul class="collapse">
  <li><a href="#tarea-11.1" id="toc-tarea-11.1" class="nav-link" data-scroll-target="#tarea-11.1">Tarea 11.1</a></li>
  <li><a href="#tarea-11.2" id="toc-tarea-11.2" class="nav-link" data-scroll-target="#tarea-11.2">Tarea 11.2</a></li>
  <li><a href="#tarea-11.3" id="toc-tarea-11.3" class="nav-link" data-scroll-target="#tarea-11.3">Tarea 11.3</a></li>
  <li><a href="#tarea-11.4" id="toc-tarea-11.4" class="nav-link" data-scroll-target="#tarea-11.4">Tarea 11.4</a></li>
  <li><a href="#tarea-11.5" id="toc-tarea-11.5" class="nav-link" data-scroll-target="#tarea-11.5">Tarea 11.5</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./21_ajuste_de_curvas.html">Unidad 5: Tópicos</a></li><li class="breadcrumb-item"><a href="./22_descenso_de_gradiente.html">Descenso de gradiente</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Decenso de Gradiente</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>En esta clase discutiremos uno de los algoritmos de optimización más usados actualmente: El descenso de gradiente.</p>
<p>Este algoritmo se usa con éxito para ajustar modelos con billones de parámetros.</p>
<p>Nosotros, más humildemente, lo usaremos para hacer un ajuste de mínimos cuadrados.</p>
<p>Para lograrlo, usaremos una de las librerías más usadas actualmente: JAX.</p>
<section id="introducción-a-jax" class="level1">
<h1>Introducción a JAX</h1>
<p>JAX es una librería de python para cálculo de alto desempeño, usando CPU, GPU, o TPU. Tiene soporte para autodiferenciación así como compilación de código para hacerlo más rápido.</p>
<section id="ventajas-de-jax" class="level2">
<h2 class="anchored" data-anchor-id="ventajas-de-jax">Ventajas de JAX</h2>
<ul>
<li><p>Compatibilidad con Numpy: Tiene varias funciones similares a las de Numpy con la misma sintaxis. Para usarlas se importa <code>jax.numpy</code>.</p></li>
<li><p>Diferenciación automática: Puede calcular el gradiente de funciones de python arbitrarias usando <code>grad</code>.</p></li>
<li><p>Compilación justo a tiempo (JIT): El código de python es lento porque es interpretado. JAX permite compilar código para hacerlo más rápido.</p></li>
<li><p>Soporte de GPU: Permite realizar algunos cálculos en la GPU para mayor eficiencia.</p></li>
</ul>
</section>
<section id="trabajando-con-arrays-de-jax" class="level2">
<h2 class="anchored" data-anchor-id="trabajando-con-arrays-de-jax">Trabajando con arrays de JAX</h2>
<div id="a807d01d" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Crear arrays</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> jnp.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> jnp.array([<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>An NVIDIA GPU may be present on this machine, but a CUDA-enabled jaxlib is not installed. Falling back to cpu.</code></pre>
</div>
</div>
<div id="ceff6fba" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sumar arrays</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> x <span class="op">+</span> y</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(z)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[5 7 9]</code></pre>
</div>
</div>
<div id="6868f62a" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Producto punto</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> jnp.dot(x, y)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>32</code></pre>
</div>
</div>
<p>Así mismo, muchas de las cosas que hace numpy con sus arrays se pueden hacer con JAX, cambiando <code>np</code> por <code>jnp</code>.</p>
</section>
<section id="diferenciación-automática-con-grad" class="level2">
<h2 class="anchored" data-anchor-id="diferenciación-automática-con-grad">Diferenciación automática con <code>grad</code></h2>
<div id="9f540e43" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Defina una función</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Calcule la derivada</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>df_dx <span class="op">=</span> jax.grad(f)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4324f82b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_dx(<span class="fl">3.0</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>Array(8., dtype=float32, weak_type=True)</code></pre>
</div>
</div>
<p>También podemos calcular gradientes de funciones de varios parámetros:</p>
<div id="65b899d8" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> g(x, y):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> x<span class="op">*</span>y</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>grad_g <span class="op">=</span> jax.grad(g, argnums<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>grad_x, grad_y <span class="op">=</span> grad_g(<span class="fl">3.0</span>, <span class="fl">4.0</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grad_x, grad_y)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10.0 11.0</code></pre>
</div>
</div>
</section>
<section id="acelerar-código-con-jit" class="level2">
<h2 class="anchored" data-anchor-id="acelerar-código-con-jit">Acelerar código con JIT</h2>
<div id="85025190" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.sin(x) <span class="op">+</span> jnp.cos(x)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>f_jit <span class="op">=</span> jax.jit(f)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b491f61c" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> jnp.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100_000_000</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3e3f64b8" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se necesita ejecutar la función una vez para obligarla a compilar</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>f_jit(x)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Array([ 1.       ,  1.0000001,  1.0000002, ..., -1.3830926, -1.3830926,
       -1.3830926], dtype=float32)</code></pre>
</div>
</div>
<div id="16ff840c" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sin JIT</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>f(x)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sin JIT: </span><span class="sc">{</span>time<span class="sc">.</span>time() <span class="op">-</span> start<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sin JIT: 0.30278468132019043</code></pre>
</div>
</div>
<div id="a7823cbe" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Con JIT</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>f_jit(x)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Con JIT: </span><span class="sc">{</span>time<span class="sc">.</span>time() <span class="op">-</span> start<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Con JIT: 0.15223383903503418</code></pre>
</div>
</div>
<p>Nota: Esta no es la manera más precisa para medir tiempos. Es sólo para ilustrar que el código compilado es más rápido.</p>
</section>
</section>
<section id="descenso-de-gradiente" class="level1">
<h1>Descenso de gradiente</h1>
<p>Este algoritmo busca el mínimo de una función de muchas variables. La idea es sencilla: La dirección del gradiente es la dirección en la cual la función cambia más rápidamente, entonces seguimos la dirección del gradiente. Si <span class="math inline">\(\vec{\theta}\)</span> son los muchos parámetros, cambiamos el punto donde evaluamos la función de la siguiente manera a cada paso</p>
<p><span class="math display">\[
\vec{\theta}_{i + 1} = \vec{\theta}_i - \eta \nabla f(\vec{\theta}_i)\,.
\]</span></p>
<p>El parámetro <span class="math inline">\(\eta\)</span> se llama “razón de aprendizaje” (learning rate) porque este algoritmo se usa mucho en métodos de aprendizaje automático.</p>
<p>Nosotros lo aplicaremos en esta clase a un problema sencillo. Queremos ajustar una curva no lineal a unos datos con ruido. Para lograrlo aplicaremos el método de mínimos cuadrados de la clase pasada.</p>
<p>Vimos que si los parámetros de ajuste aparecen de forma lineal, basta resolver un sistema de ecuaciones. Cuando aparecen de forma no lineal tenemos que encontrar el mínimo de la suma de las desviaciones al cuadrado de alguna otra manera. Lo haremos con descenso de gradiente, donde nuestra función a minimizar es</p>
<p><span class="math display">\[
f(\vec{\theta}) = \sum_i (\hat{y}_{\vec{\theta}}(x_i)) - y_i)^2\,,
\]</span></p>
<p>donde <span class="math inline">\(\hat{y}_{\vec{\theta}}\)</span> es la función de ajuste que depende de los parámetros.</p>
<p>Los datos que vamos a ajustar vienen de una función no-lineal:</p>
<p><span class="math display">\[
y(x) = e^{-x/2}\,.
\]</span></p>
<p>Creamos datos ficticios con un ruido:</p>
<div id="ae456425" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar datos ficticios</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>x_data <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> np.exp(<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> x_data)  <span class="co"># True model parameters</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>y_data <span class="op">=</span> y_true <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.1</span>, size<span class="op">=</span>x_data.shape)  <span class="co"># Add noise</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El modelo que queremos ajustar es</p>
<p><span class="math display">\[
\hat{y}_{\vec{\theta}}(x) = \theta_0e^{-\theta_1 x}\,.
\]</span></p>
<div id="cfc74839" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> modelo(x, theta):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta[<span class="dv">0</span>]<span class="op">*</span>jnp.exp(<span class="op">-</span>theta[<span class="dv">1</span>]<span class="op">*</span>x)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="minimización" class="level2">
<h2 class="anchored" data-anchor-id="minimización">Minimización</h2>
<p>Definimos primero la función a minimizar:</p>
<div id="06f4b1db" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> suma_cuadrados(theta, x, y):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    predicciones <span class="op">=</span> modelo(x, theta)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.<span class="bu">sum</span>((y <span class="op">-</span> predicciones)<span class="op">**</span><span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El siguiente es un algoritmo sencillo de minimización por descenso de gradiente:</p>
<div id="f019475f" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>gradiente <span class="op">=</span> jax.grad(suma_cuadrados)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gradient_descent(theta, x, y, learning_rate<span class="op">=</span><span class="fl">0.01</span>, iterations<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(iterations):</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        gradients <span class="op">=</span> gradiente(theta, x, y)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">=</span> theta <span class="op">-</span> learning_rate <span class="op">*</span> gradients</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Imprimimos el resultado cada 100 iteraciones</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> suma_cuadrados(theta, x, y)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Iteración </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, Suma cuadrados: </span><span class="sc">{</span>loss<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6011fd0d" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros iniciales</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>theta_init <span class="op">=</span> jnp.array([<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Descenso de gradiente</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>theta_opt <span class="op">=</span> gradient_descent(theta_init, x_data, y_data, learning_rate<span class="op">=</span><span class="fl">0.001</span>, iterations<span class="op">=</span><span class="dv">3000</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros encontrados</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parámetros optimizados:"</span>, theta_opt)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteración 0, Suma cuadrados: 2.8259427547454834
Iteración 100, Suma cuadrados: 0.9898320436477661
Iteración 200, Suma cuadrados: 0.9269558191299438
Iteración 300, Suma cuadrados: 0.9178450703620911
Iteración 400, Suma cuadrados: 0.9157513976097107
Iteración 500, Suma cuadrados: 0.9152856469154358
Iteración 600, Suma cuadrados: 0.9151836037635803
Iteración 700, Suma cuadrados: 0.9151614308357239
Iteración 800, Suma cuadrados: 0.9151566028594971
Iteración 900, Suma cuadrados: 0.9151556491851807
Iteración 1000, Suma cuadrados: 0.9151554107666016
Iteración 1100, Suma cuadrados: 0.915155291557312
Iteración 1200, Suma cuadrados: 0.915155291557312
Iteración 1300, Suma cuadrados: 0.915155291557312
Iteración 1400, Suma cuadrados: 0.9151553511619568
Iteración 1500, Suma cuadrados: 0.9151553511619568
Iteración 1600, Suma cuadrados: 0.9151553511619568
Iteración 1700, Suma cuadrados: 0.9151553511619568
Iteración 1800, Suma cuadrados: 0.9151553511619568
Iteración 1900, Suma cuadrados: 0.9151553511619568
Iteración 2000, Suma cuadrados: 0.9151553511619568
Iteración 2100, Suma cuadrados: 0.9151553511619568
Iteración 2200, Suma cuadrados: 0.9151553511619568
Iteración 2300, Suma cuadrados: 0.9151553511619568
Iteración 2400, Suma cuadrados: 0.9151553511619568
Iteración 2500, Suma cuadrados: 0.9151553511619568
Iteración 2600, Suma cuadrados: 0.9151553511619568
Iteración 2700, Suma cuadrados: 0.9151553511619568
Iteración 2800, Suma cuadrados: 0.9151553511619568
Iteración 2900, Suma cuadrados: 0.9151553511619568
Parámetros optimizados: [1.1409745  0.56464535 1.        ]</code></pre>
</div>
</div>
<div id="fa3a70f3" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_data, y_data, label<span class="op">=</span><span class="st">"Datos"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.plot(x_data, modelo(x_data, theta_opt), color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Modelo ajustado"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'y'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Ajuste de mínimos cuadrados no lineal con descenso de gradiente'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="22_descenso_de_gradiente_files/figure-html/cell-18-output-1.png" width="605" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="mejoras-al-descenso-de-gradiente" class="level1">
<h1>Mejoras al descenso de gradiente</h1>
<p>El algoritmo de descenso de gradiente visto arriba no funciona bien para muchos casos. Discutiremos algunas de las maneras de mejorarlo.</p>
<p>Para estos ejemplos usemos los siguientes datos:</p>
<p><span class="math display">\[
y(x) = (\theta_0 x)^2 e^{\theta_1 x}
\]</span></p>
<div id="bb90bade" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar datos ficticios</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>x_data <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> (<span class="dv">2</span><span class="op">*</span>x_data)<span class="op">**</span><span class="dv">2</span><span class="op">*</span>np.exp(<span class="op">-</span>x_data<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>y_data <span class="op">=</span> y_true <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.2</span>, size<span class="op">=</span>x_data.shape)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> modelo(x, theta):</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (theta[<span class="dv">0</span>]<span class="op">*</span>x)<span class="op">**</span><span class="dv">2</span><span class="op">*</span>jnp.exp(<span class="op">-</span>theta[<span class="dv">1</span>]<span class="op">*</span>x) </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> suma_cuadrados(theta, x, y):</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    predicciones <span class="op">=</span> modelo(x, theta)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.<span class="bu">sum</span>((y <span class="op">-</span> predicciones)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>gradiente <span class="op">=</span> jax.grad(suma_cuadrados)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gradient_descent(theta, x, y, learning_rate<span class="op">=</span><span class="fl">0.01</span>, iterations<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(iterations):</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        gradients <span class="op">=</span> gradiente(theta, x, y)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">=</span> theta <span class="op">-</span> learning_rate <span class="op">*</span> gradients</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Imprimimos el resultado cada 100 iteraciones</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> suma_cuadrados(theta, x, y)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Iteración </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, Suma cuadrados: </span><span class="sc">{</span>loss<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros iniciales</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>theta_init <span class="op">=</span> jnp.array([<span class="fl">1.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Descenso de gradiente</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>theta_opt <span class="op">=</span> gradient_descent(theta_init, x_data, y_data, learning_rate<span class="op">=</span><span class="fl">0.001</span>, iterations<span class="op">=</span><span class="dv">3000</span>)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros encontrados</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parámetros optimizados:"</span>, theta_opt)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteración 0, Suma cuadrados: 21042.046875
Iteración 100, Suma cuadrados: 3676.298583984375
Iteración 200, Suma cuadrados: 3676.298583984375
Iteración 300, Suma cuadrados: 3676.298583984375
Iteración 400, Suma cuadrados: 3676.298583984375
Iteración 500, Suma cuadrados: 3676.298583984375
Iteración 600, Suma cuadrados: 3676.298583984375
Iteración 700, Suma cuadrados: 3676.298583984375
Iteración 800, Suma cuadrados: 3676.298583984375
Iteración 900, Suma cuadrados: 3676.298583984375
Iteración 1000, Suma cuadrados: 3676.298583984375
Iteración 1100, Suma cuadrados: 3676.298583984375
Iteración 1200, Suma cuadrados: 3676.298583984375
Iteración 1300, Suma cuadrados: 3676.298583984375
Iteración 1400, Suma cuadrados: 3676.298583984375
Iteración 1500, Suma cuadrados: 3676.298583984375
Iteración 1600, Suma cuadrados: 3676.298583984375
Iteración 1700, Suma cuadrados: 3676.298583984375
Iteración 1800, Suma cuadrados: 3676.298583984375
Iteración 1900, Suma cuadrados: 3676.298583984375
Iteración 2000, Suma cuadrados: 3676.298583984375
Iteración 2100, Suma cuadrados: 3676.298583984375
Iteración 2200, Suma cuadrados: 3676.298583984375
Iteración 2300, Suma cuadrados: 3676.298583984375
Iteración 2400, Suma cuadrados: 3676.298583984375
Iteración 2500, Suma cuadrados: 3676.298583984375
Iteración 2600, Suma cuadrados: 3676.298583984375
Iteración 2700, Suma cuadrados: 3676.298583984375
Iteración 2800, Suma cuadrados: 3676.298583984375
Iteración 2900, Suma cuadrados: 3676.298583984375
Parámetros optimizados: [-72.194016 414.01147 ]</code></pre>
</div>
</div>
<div id="bdc0bf6d" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_data, y_data, label<span class="op">=</span><span class="st">"Datos"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plt.plot(x_data, modelo(x_data, theta_opt), color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Modelo ajustado"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x'</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'y'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Ajuste de mínimos cuadrados no lineal con descenso de gradiente'</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="22_descenso_de_gradiente_files/figure-html/cell-20-output-1.png" width="582" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Para ver lo que ocurre, grafiquemos la función de pérdida</p>
<section id="momentum" class="level2">
<h2 class="anchored" data-anchor-id="momentum">Momentum</h2>
<p>Cuando se minimizan funciones de varias dimensiones, con frecuencia tienen múltiples mínimos locales.</p>
<p>El descenso de gradiente mostrado arriba se quedará atascado en esos mínimos locales.</p>
<p>Para evitarlo, podemos imaginar una bolita que rueda por una pendiente. Esta no se atasca en pequeños huecos porque su momentum la ayuda a continuar. Podemos agregarle también un momentum a la velocidad del descenso de gradiente:</p>
<p><span class="math display">\[
\vec{m}_{t+1} = \beta\vec{m}_t - \eta \nabla f(\vec{\theta_t})\,,
\]</span> <span class="math display">\[
\vec{\theta}_{t+1} = \vec{\theta}_t + \vec{m}_{t+1}\,.
\]</span></p>
<p>Escribamos un código que lo implemente en JAX</p>
<div id="2fa8c871" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gradient_descent_momentum(theta, x, y, learning_rate<span class="op">=</span><span class="fl">0.001</span>, momentum<span class="op">=</span><span class="fl">0.9</span>, iterations<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    velocity <span class="op">=</span> jnp.zeros_like(theta)  <span class="co"># Inicializar el término de velocidad</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(iterations):</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        gradients <span class="op">=</span> gradiente(theta, x, y)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        velocity <span class="op">=</span> momentum <span class="op">*</span> velocity <span class="op">-</span> learning_rate <span class="op">*</span> gradients</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">=</span> theta <span class="op">+</span> velocity</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> suma_cuadrados(theta, x, y)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Iteración </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, Suma cuadrados: </span><span class="sc">{</span>loss<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f945f400" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros iniciales</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>theta_init <span class="op">=</span> jnp.array([<span class="fl">1.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Descenso de gradiente</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>theta_opt <span class="op">=</span> gradient_descent_momentum(theta_init, x_data, y_data, learning_rate<span class="op">=</span><span class="fl">0.001</span>, iterations<span class="op">=</span><span class="dv">3000</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros encontrados</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parámetros optimizados:"</span>, theta_opt)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_data, y_data, label<span class="op">=</span><span class="st">"Datos"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>plt.plot(x_data, modelo(x_data, theta_opt), color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Modelo ajustado"</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x'</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'y'</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Ajuste de mínimos cuadrados no-lineal con momentum'</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteración 0, Suma cuadrados: 21042.046875
Iteración 100, Suma cuadrados: 3676.298583984375
Iteración 200, Suma cuadrados: 3676.298583984375
Iteración 300, Suma cuadrados: 3676.298583984375
Iteración 400, Suma cuadrados: 3676.298583984375
Iteración 500, Suma cuadrados: 3676.298583984375
Iteración 600, Suma cuadrados: 3676.298583984375
Iteración 700, Suma cuadrados: 3676.298583984375
Iteración 800, Suma cuadrados: 3676.298583984375
Iteración 900, Suma cuadrados: 3676.298583984375
Iteración 1000, Suma cuadrados: 3676.298583984375
Iteración 1100, Suma cuadrados: 3676.298583984375
Iteración 1200, Suma cuadrados: 3676.298583984375
Iteración 1300, Suma cuadrados: 3676.298583984375
Iteración 1400, Suma cuadrados: 3676.298583984375
Iteración 1500, Suma cuadrados: 3676.298583984375
Iteración 1600, Suma cuadrados: 3676.298583984375
Iteración 1700, Suma cuadrados: 3676.298583984375
Iteración 1800, Suma cuadrados: 3676.298583984375
Iteración 1900, Suma cuadrados: 3676.298583984375
Iteración 2000, Suma cuadrados: 3676.298583984375
Iteración 2100, Suma cuadrados: 3676.298583984375
Iteración 2200, Suma cuadrados: 3676.298583984375
Iteración 2300, Suma cuadrados: 3676.298583984375
Iteración 2400, Suma cuadrados: 3676.298583984375
Iteración 2500, Suma cuadrados: 3676.298583984375
Iteración 2600, Suma cuadrados: 3676.298583984375
Iteración 2700, Suma cuadrados: 3676.298583984375
Iteración 2800, Suma cuadrados: 3676.298583984375
Iteración 2900, Suma cuadrados: 3676.298583984375
Parámetros optimizados: [-730.93976 4131.1123 ]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="22_descenso_de_gradiente_files/figure-html/cell-22-output-2.png" width="576" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="rmsprop" class="level2">
<h2 class="anchored" data-anchor-id="rmsprop">RMSProp</h2>
<p>A veces el gradiente sigue la dirección más empinada. Pero esto puede hacer que termine oscilando alrededor de un “valle”.</p>
<p>Para evitar eso, se introdujo un término que reduce la dirección más empinada:</p>
<p><span class="math display">\[
\begin{align}
\vec{s}_{i+1} &amp;= \rho\vec{s}_i + (1 - \rho)\nabla_{\vec{\theta}}f \otimes  \nabla_{\vec{\theta}}f\,,\\
\vec{\theta} &amp;\leftarrow \vec{\theta} - \eta\nabla_{\vec{\theta}}f\oslash\sqrt{\vec{s} \oplus \epsilon}\,,
\end{align}
\]</span></p>
<p>donde <span class="math inline">\(\otimes\)</span>, <span class="math inline">\(\oplus\)</span> <span class="math inline">\(\oslash\)</span> son la suma, multiplicación y división elemento por elemento de cada array.</p>
<ul>
<li>El vector <span class="math inline">\(\vec{s}\)</span> actúa reduciendo el tamaño del gradiente. Esta reducción es mayor para las direcciones empinadas.</li>
<li>Aquí el parámetro <span class="math inline">\(\rho\)</span> controla cuánto se modifica <span class="math inline">\(\vec{s}\)</span> a cada paso. Para <span class="math inline">\(\rho\)</span> cercano a 1, se modifica muy poco y tiene una “memoria larga”. Para <span class="math inline">\(\rho\)</span> pequeño se modifica mucho pero tiene una “memoria corta” ya que su valor cambia rápidamente.</li>
<li>El <span class="math inline">\(\epsilon\)</span> sirve solamente a que no haya divisiones por cero cuando alguna componente de <span class="math inline">\(\vec{s}\)</span> es cero.</li>
</ul>
<div id="c73bf8a7" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gradient_descent_rmsprop(theta, x, y, learning_rate<span class="op">=</span><span class="fl">0.001</span>, beta<span class="op">=</span><span class="fl">0.9</span>, epsilon<span class="op">=</span><span class="fl">1e-8</span>, iterations<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    cache <span class="op">=</span> jnp.zeros_like(theta)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(iterations):</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        grads <span class="op">=</span> gradiente(theta, x, y)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        cache <span class="op">=</span> beta <span class="op">*</span> cache <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> beta) <span class="op">*</span> (grads <span class="op">**</span> <span class="dv">2</span>)  <span class="co"># Actualizar la media móvil de los gradientes al cuadrado</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">=</span> theta <span class="op">-</span> learning_rate <span class="op">*</span> grads <span class="op">/</span> (jnp.sqrt(cache) <span class="op">+</span> epsilon)  <span class="co"># Actualizar los parámetros</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> suma_cuadrados(theta, x, y)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Iteración </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, Suma cuadrados: </span><span class="sc">{</span>loss<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8555e96a" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros iniciales</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>theta_init <span class="op">=</span> jnp.array([<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Descenso de gradiente</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>theta_opt <span class="op">=</span> gradient_descent_rmsprop(theta_init, x_data, y_data, learning_rate<span class="op">=</span><span class="fl">0.001</span>, iterations<span class="op">=</span><span class="dv">3000</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros encontrados</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parámetros optimizados:"</span>, theta_opt)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_data, y_data, label<span class="op">=</span><span class="st">"Datos"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>plt.plot(x_data, modelo(x_data, theta_opt), color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Modelo ajustado"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x'</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'y'</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Ajuste de mínimos cuadrados no-lineal con momentum'</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteración 0, Suma cuadrados: 3429.28564453125
Iteración 100, Suma cuadrados: 3235.61865234375
Iteración 200, Suma cuadrados: 2916.4580078125
Iteración 300, Suma cuadrados: 2370.6962890625
Iteración 400, Suma cuadrados: 1490.12548828125
Iteración 500, Suma cuadrados: 401.747802734375
Iteración 600, Suma cuadrados: 90.45291137695312
Iteración 700, Suma cuadrados: 51.823265075683594
Iteración 800, Suma cuadrados: 25.26919937133789
Iteración 900, Suma cuadrados: 9.870442390441895
Iteración 1000, Suma cuadrados: 4.351919174194336
Iteración 1100, Suma cuadrados: 4.078932762145996
Iteración 1200, Suma cuadrados: 4.078771591186523
Iteración 1300, Suma cuadrados: 4.0787553787231445
Iteración 1400, Suma cuadrados: 4.078762054443359
Iteración 1500, Suma cuadrados: 4.078766345977783
Iteración 1600, Suma cuadrados: 4.078766345977783
Iteración 1700, Suma cuadrados: 4.078766345977783
Iteración 1800, Suma cuadrados: 4.078766345977783
Iteración 1900, Suma cuadrados: 4.078762054443359
Iteración 2000, Suma cuadrados: 4.0787553787231445
Iteración 2100, Suma cuadrados: 4.078762054443359
Iteración 2200, Suma cuadrados: 4.078766345977783
Iteración 2300, Suma cuadrados: 4.078766345977783
Iteración 2400, Suma cuadrados: 4.078766345977783
Iteración 2500, Suma cuadrados: 4.078766345977783
Iteración 2600, Suma cuadrados: 4.078762054443359
Iteración 2700, Suma cuadrados: 4.0787553787231445
Iteración 2800, Suma cuadrados: 4.078762054443359
Iteración 2900, Suma cuadrados: 4.078766345977783
Parámetros optimizados: [1.9991218  0.49982956 1.        ]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="22_descenso_de_gradiente_files/figure-html/cell-24-output-2.png" width="576" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="adam" class="level2">
<h2 class="anchored" data-anchor-id="adam">Adam</h2>
<p>Este y sus derivados es uno de los algoritmos más usados actualmente.</p>
<p>Este método adaptativo combina momentum con RMSprop</p>
<p><span class="math display">\[
\begin{align}
\vec{m}_{i+1} &amp;= \beta_1 \vec{m}_i - (1 - \beta_1) \nabla_{\vec{\theta}}f(\vec{\theta})\,,\\
\vec{s}_{i+1} &amp;= \beta_2\vec{s}_i + (1 - \beta_2)\nabla_{\vec{\theta}}f \otimes  \nabla_{\vec{\theta}}f\,,\\
\hat{\vec{m}}_{i+1} &amp; = \frac{\vec{m}_{i+1}}{1 - (\beta_1)^i}\,,\\
\hat{\vec{s}}_{i+1} &amp; = \frac{\vec{s}_{i+1}}{1 - (\beta_2)^i}\,,\\
\vec{\theta}_{i+1} &amp;= \vec{\theta}_i - \eta\hat{\vec{m}}_{i+1}\oslash\sqrt{\hat{\vec{s}}_{i+1} \oplus \epsilon}
\end{align}
\]</span></p>
<p>El tercer y cuarto pasos sirven para hacer que <span class="math inline">\(\vec{m}\)</span> y <span class="math inline">\(\vec{s}\)</span> no sean demasiado pequeños durante las primeras iteraciones. De otra forma tenderán a estar cercanos a <span class="math inline">\(0\)</span> ya que ese es su valor inicial.</p>
<div id="4de78a2e" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gradient_descent_adam(theta, x, y, learning_rate<span class="op">=</span><span class="fl">0.001</span>, beta1<span class="op">=</span><span class="fl">0.9</span>, beta2<span class="op">=</span><span class="fl">0.999</span>, epsilon<span class="op">=</span><span class="fl">1e-8</span>, iterations<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    m, v <span class="op">=</span> jnp.zeros_like(theta), jnp.zeros_like(theta)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, iterations <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        grads <span class="op">=</span> gradiente(theta, x, y)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> beta1 <span class="op">*</span> m <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> beta1) <span class="op">*</span> grads  </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> beta2 <span class="op">*</span> v <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> beta2) <span class="op">*</span> (grads <span class="op">**</span> <span class="dv">2</span>)  </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        m_hat <span class="op">=</span> m <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> beta1 <span class="op">**</span> t)  </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        v_hat <span class="op">=</span> v <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> beta2 <span class="op">**</span> t)  </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">=</span> theta <span class="op">-</span> learning_rate <span class="op">*</span> m_hat <span class="op">/</span> (jnp.sqrt(v_hat) <span class="op">+</span> epsilon)  </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> t <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> suma_cuadrados(theta, x, y)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Iteración </span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">, Suma cuadrados: </span><span class="sc">{</span>loss<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="250072ab" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros iniciales</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>theta_init <span class="op">=</span> jnp.array([<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Descenso de gradiente</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>theta_opt <span class="op">=</span> gradient_descent_adam(theta_init, x_data, y_data, learning_rate<span class="op">=</span><span class="fl">0.001</span>, iterations<span class="op">=</span><span class="dv">3000</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros encontrados</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parámetros optimizados:"</span>, theta_opt)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_data, y_data, label<span class="op">=</span><span class="st">"Datos"</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>plt.plot(x_data, modelo(x_data, theta_opt), color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Modelo ajustado"</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x'</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'y'</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Ajuste de mínimos cuadrados no-lineal con momentum'</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteración 100, Suma cuadrados: 3247.58837890625
Iteración 200, Suma cuadrados: 2781.5439453125
Iteración 300, Suma cuadrados: 1436.5238037109375
Iteración 400, Suma cuadrados: 125.83804321289062
Iteración 500, Suma cuadrados: 108.08612060546875
Iteración 600, Suma cuadrados: 91.434326171875
Iteración 700, Suma cuadrados: 76.28627014160156
Iteración 800, Suma cuadrados: 62.861900329589844
Iteración 900, Suma cuadrados: 51.22740173339844
Iteración 1000, Suma cuadrados: 41.343177795410156
Iteración 1100, Suma cuadrados: 33.09865188598633
Iteración 1200, Suma cuadrados: 26.340545654296875
Iteración 1300, Suma cuadrados: 20.89400863647461
Iteración 1400, Suma cuadrados: 16.57770538330078
Iteración 1500, Suma cuadrados: 13.214654922485352
Iteración 1600, Suma cuadrados: 10.63939094543457
Iteración 1700, Suma cuadrados: 8.70242691040039
Iteración 1800, Suma cuadrados: 7.272426605224609
Iteración 1900, Suma cuadrados: 6.237037658691406
Iteración 2000, Suma cuadrados: 5.502582550048828
Iteración 2100, Suma cuadrados: 4.9926910400390625
Iteración 2200, Suma cuadrados: 4.646664619445801
Iteración 2300, Suma cuadrados: 4.4174346923828125
Iteración 2400, Suma cuadrados: 4.26937198638916
Iteración 2500, Suma cuadrados: 4.176309585571289
Iteración 2600, Suma cuadrados: 4.119433879852295
Iteración 2700, Suma cuadrados: 4.085715293884277
Iteración 2800, Suma cuadrados: 4.06633996963501
Iteración 2900, Suma cuadrados: 4.055578231811523
Iteración 3000, Suma cuadrados: 4.049807548522949
Parámetros optimizados: [1.9952817  0.49972048 1.        ]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="22_descenso_de_gradiente_files/figure-html/cell-26-output-2.png" width="576" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="usando-flax" class="level1">
<h1>Usando Flax</h1>
<p>Estos métodos están ya todos programados en varias librerías. Una de las más usadas con JAX es Flax.</p>
<p>Flax en general es una librería para aprendizaje automático con redes neuronales. Tiene también el descenso de gradiente.</p>
<div id="1dc06f62" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flax.training <span class="im">import</span> train_state  </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optax  </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TrainState(train_state.TrainState):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    params: jnp.ndarray</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_train_state(params, learning_rate):</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    tx <span class="op">=</span> optax.adam(learning_rate<span class="op">=</span><span class="fl">0.1</span>)  <span class="co"># SGD con Momentum</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> TrainState.create(apply_fn<span class="op">=</span><span class="va">None</span>, params<span class="op">=</span>params, tx<span class="op">=</span>tx)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar el descenso de gradiente por un paso</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.jit</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_step(state, x, y):</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> loss_fn_wrapper(params):</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> suma_cuadrados(params, x, y)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    grads <span class="op">=</span> jax.grad(loss_fn_wrapper)(state.params)  </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    new_state <span class="op">=</span> state.apply_gradients(grads<span class="op">=</span>grads)   </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_state</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros iniciales</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>theta_init <span class="op">=</span> jnp.array([<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el estado a entrenar</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> create_train_state(theta_init, learning_rate)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenamiento</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>iterations <span class="op">=</span> <span class="dv">30000</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(iterations):</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> train_step(state, x_data, y_data)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> suma_cuadrados(state.params, x_data, y_data)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Iteración </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, Suma cuadrados: </span><span class="sc">{</span>loss<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>theta_opt <span class="op">=</span> state.params</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parámetros optimizados:"</span>, theta_opt)</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_data, y_data, label<span class="op">=</span><span class="st">"Datos"</span>)</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>plt.plot(x_data, modelo(x_data, theta_opt), color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Modelo ajustado"</span>)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x'</span>)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'y'</span>)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Ajuste de mínimos cuadrados no-lineal con momentum'</span>)</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteración 0, Suma cuadrados: 3267.792724609375
Iteración 100, Suma cuadrados: 4.0442657470703125
Iteración 200, Suma cuadrados: 4.044096946716309
Iteración 300, Suma cuadrados: 4.04409122467041
Iteración 400, Suma cuadrados: 4.044095039367676
Iteración 500, Suma cuadrados: 4.044095516204834
Iteración 600, Suma cuadrados: 4.044095039367676
Iteración 700, Suma cuadrados: 4.044094085693359
Iteración 800, Suma cuadrados: 4.04409122467041
Iteración 900, Suma cuadrados: 4.044095039367676
Iteración 1000, Suma cuadrados: 4.044095039367676
Iteración 1100, Suma cuadrados: 4.04409122467041
Iteración 1200, Suma cuadrados: 4.04409122467041
Iteración 1300, Suma cuadrados: 4.044095039367676
Iteración 1400, Suma cuadrados: 4.04409122467041
Iteración 1500, Suma cuadrados: 4.044095039367676
Iteración 1600, Suma cuadrados: 4.044095039367676
Iteración 1700, Suma cuadrados: 4.044095039367676
Iteración 1800, Suma cuadrados: 4.044095039367676
Iteración 1900, Suma cuadrados: 4.044094085693359
Iteración 2000, Suma cuadrados: 4.044095039367676
Iteración 2100, Suma cuadrados: 4.04409122467041
Iteración 2200, Suma cuadrados: 4.044095039367676
Iteración 2300, Suma cuadrados: 4.04409122467041
Iteración 2400, Suma cuadrados: 4.044095039367676
Iteración 2500, Suma cuadrados: 4.04409122467041
Iteración 2600, Suma cuadrados: 4.04409122467041
Iteración 2700, Suma cuadrados: 4.044095039367676
Iteración 2800, Suma cuadrados: 4.044095039367676
Iteración 2900, Suma cuadrados: 5.471590995788574
Iteración 3000, Suma cuadrados: 4.045629501342773
Iteración 3100, Suma cuadrados: 4.046225070953369
Iteración 3200, Suma cuadrados: 4.121339797973633
Iteración 3300, Suma cuadrados: 6.206316947937012
Iteración 3400, Suma cuadrados: 4.071436882019043
Iteración 3500, Suma cuadrados: 5.57887077331543
Iteración 3600, Suma cuadrados: 6.284522533416748
Iteración 3700, Suma cuadrados: 4.072629928588867
Iteración 3800, Suma cuadrados: 4.14105224609375
Iteración 3900, Suma cuadrados: 4.619814872741699
Iteración 4000, Suma cuadrados: 6.086818218231201
Iteración 4100, Suma cuadrados: 5.390110969543457
Iteración 4200, Suma cuadrados: 4.494438171386719
Iteración 4300, Suma cuadrados: 4.305286407470703
Iteración 4400, Suma cuadrados: 4.045108795166016
Iteración 4500, Suma cuadrados: 4.082281112670898
Iteración 4600, Suma cuadrados: 4.154871940612793
Iteración 4700, Suma cuadrados: 7.406267166137695
Iteración 4800, Suma cuadrados: 4.285836219787598
Iteración 4900, Suma cuadrados: 4.426356315612793
Iteración 5000, Suma cuadrados: 10.884464263916016
Iteración 5100, Suma cuadrados: 5.174866676330566
Iteración 5200, Suma cuadrados: 4.076207160949707
Iteración 5300, Suma cuadrados: 6.2567548751831055
Iteración 5400, Suma cuadrados: 4.334840774536133
Iteración 5500, Suma cuadrados: 4.5783185958862305
Iteración 5600, Suma cuadrados: 5.041240215301514
Iteración 5700, Suma cuadrados: 4.548403739929199
Iteración 5800, Suma cuadrados: 4.1995134353637695
Iteración 5900, Suma cuadrados: 4.047691345214844
Iteración 6000, Suma cuadrados: 7.766546249389648
Iteración 6100, Suma cuadrados: 5.101372241973877
Iteración 6200, Suma cuadrados: 4.584712028503418
Iteración 6300, Suma cuadrados: 8.226726531982422
Iteración 6400, Suma cuadrados: 4.6013994216918945
Iteración 6500, Suma cuadrados: 4.727679252624512
Iteración 6600, Suma cuadrados: 4.347781181335449
Iteración 6700, Suma cuadrados: 4.181650638580322
Iteración 6800, Suma cuadrados: 4.263227462768555
Iteración 6900, Suma cuadrados: 4.52927827835083
Iteración 7000, Suma cuadrados: 4.246344566345215
Iteración 7100, Suma cuadrados: 6.417340278625488
Iteración 7200, Suma cuadrados: 5.166752815246582
Iteración 7300, Suma cuadrados: 4.220556259155273
Iteración 7400, Suma cuadrados: 5.387799263000488
Iteración 7500, Suma cuadrados: 5.238258361816406
Iteración 7600, Suma cuadrados: 4.062378406524658
Iteración 7700, Suma cuadrados: 4.832957744598389
Iteración 7800, Suma cuadrados: 4.256785869598389
Iteración 7900, Suma cuadrados: 4.119063854217529
Iteración 8000, Suma cuadrados: 5.263709545135498
Iteración 8100, Suma cuadrados: 5.915206432342529
Iteración 8200, Suma cuadrados: 4.315390586853027
Iteración 8300, Suma cuadrados: 4.220365524291992
Iteración 8400, Suma cuadrados: 4.06153678894043
Iteración 8500, Suma cuadrados: 4.368973731994629
Iteración 8600, Suma cuadrados: 4.623717308044434
Iteración 8700, Suma cuadrados: 5.786194801330566
Iteración 8800, Suma cuadrados: 4.525938987731934
Iteración 8900, Suma cuadrados: 4.059689521789551
Iteración 9000, Suma cuadrados: 4.502852439880371
Iteración 9100, Suma cuadrados: 4.507997035980225
Iteración 9200, Suma cuadrados: 4.5473480224609375
Iteración 9300, Suma cuadrados: 4.409025192260742
Iteración 9400, Suma cuadrados: 4.304195880889893
Iteración 9500, Suma cuadrados: 5.124032974243164
Iteración 9600, Suma cuadrados: 5.0498881340026855
Iteración 9700, Suma cuadrados: 4.810750961303711
Iteración 9800, Suma cuadrados: 4.192280292510986
Iteración 9900, Suma cuadrados: 4.429644584655762
Iteración 10000, Suma cuadrados: 5.923192977905273
Iteración 10100, Suma cuadrados: 4.153621673583984
Iteración 10200, Suma cuadrados: 4.137456893920898
Iteración 10300, Suma cuadrados: 5.773155212402344
Iteración 10400, Suma cuadrados: 4.047209739685059
Iteración 10500, Suma cuadrados: 4.082477569580078
Iteración 10600, Suma cuadrados: 5.268391132354736
Iteración 10700, Suma cuadrados: 4.422891139984131
Iteración 10800, Suma cuadrados: 4.758668899536133
Iteración 10900, Suma cuadrados: 4.056825637817383
Iteración 11000, Suma cuadrados: 4.147940635681152
Iteración 11100, Suma cuadrados: 4.312173843383789
Iteración 11200, Suma cuadrados: 4.435616493225098
Iteración 11300, Suma cuadrados: 4.4754109382629395
Iteración 11400, Suma cuadrados: 4.285840034484863
Iteración 11500, Suma cuadrados: 4.059900283813477
Iteración 11600, Suma cuadrados: 4.41378927230835
Iteración 11700, Suma cuadrados: 9.626407623291016
Iteración 11800, Suma cuadrados: 4.944194793701172
Iteración 11900, Suma cuadrados: 4.183115005493164
Iteración 12000, Suma cuadrados: 4.044503211975098
Iteración 12100, Suma cuadrados: 4.20684289932251
Iteración 12200, Suma cuadrados: 9.678367614746094
Iteración 12300, Suma cuadrados: 4.074411392211914
Iteración 12400, Suma cuadrados: 5.628018379211426
Iteración 12500, Suma cuadrados: 4.372136116027832
Iteración 12600, Suma cuadrados: 4.04418420791626
Iteración 12700, Suma cuadrados: 4.2814531326293945
Iteración 12800, Suma cuadrados: 5.68199348449707
Iteración 12900, Suma cuadrados: 4.346493244171143
Iteración 13000, Suma cuadrados: 4.40957498550415
Iteración 13100, Suma cuadrados: 4.045331954956055
Iteración 13200, Suma cuadrados: 4.239386558532715
Iteración 13300, Suma cuadrados: 4.047881603240967
Iteración 13400, Suma cuadrados: 4.12317419052124
Iteración 13500, Suma cuadrados: 5.263510704040527
Iteración 13600, Suma cuadrados: 4.7643141746521
Iteración 13700, Suma cuadrados: 4.814492225646973
Iteración 13800, Suma cuadrados: 4.081429958343506
Iteración 13900, Suma cuadrados: 6.026717185974121
Iteración 14000, Suma cuadrados: 4.047952651977539
Iteración 14100, Suma cuadrados: 4.708639621734619
Iteración 14200, Suma cuadrados: 6.692774772644043
Iteración 14300, Suma cuadrados: 6.118167400360107
Iteración 14400, Suma cuadrados: 4.373660564422607
Iteración 14500, Suma cuadrados: 8.632919311523438
Iteración 14600, Suma cuadrados: 5.144014835357666
Iteración 14700, Suma cuadrados: 4.6295061111450195
Iteración 14800, Suma cuadrados: 6.794267654418945
Iteración 14900, Suma cuadrados: 4.426146507263184
Iteración 15000, Suma cuadrados: 5.116991996765137
Iteración 15100, Suma cuadrados: 4.083767890930176
Iteración 15200, Suma cuadrados: 4.245124816894531
Iteración 15300, Suma cuadrados: 5.138859748840332
Iteración 15400, Suma cuadrados: 5.215333461761475
Iteración 15500, Suma cuadrados: 4.044112682342529
Iteración 15600, Suma cuadrados: 5.346697807312012
Iteración 15700, Suma cuadrados: 4.251892566680908
Iteración 15800, Suma cuadrados: 4.063446998596191
Iteración 15900, Suma cuadrados: 6.5082807540893555
Iteración 16000, Suma cuadrados: 4.681329727172852
Iteración 16100, Suma cuadrados: 4.596615791320801
Iteración 16200, Suma cuadrados: 4.428354263305664
Iteración 16300, Suma cuadrados: 5.403054714202881
Iteración 16400, Suma cuadrados: 4.2056474685668945
Iteración 16500, Suma cuadrados: 7.3341546058654785
Iteración 16600, Suma cuadrados: 4.370957374572754
Iteración 16700, Suma cuadrados: 4.233997344970703
Iteración 16800, Suma cuadrados: 4.1354851722717285
Iteración 16900, Suma cuadrados: 4.812607288360596
Iteración 17000, Suma cuadrados: 4.210143089294434
Iteración 17100, Suma cuadrados: 4.055096626281738
Iteración 17200, Suma cuadrados: 5.059120178222656
Iteración 17300, Suma cuadrados: 4.20456600189209
Iteración 17400, Suma cuadrados: 4.848971366882324
Iteración 17500, Suma cuadrados: 4.900928497314453
Iteración 17600, Suma cuadrados: 4.4938530921936035
Iteración 17700, Suma cuadrados: 4.390709400177002
Iteración 17800, Suma cuadrados: 4.295697212219238
Iteración 17900, Suma cuadrados: 4.051713466644287
Iteración 18000, Suma cuadrados: 4.343985080718994
Iteración 18100, Suma cuadrados: 4.195722579956055
Iteración 18200, Suma cuadrados: 4.573965549468994
Iteración 18300, Suma cuadrados: 4.2401933670043945
Iteración 18400, Suma cuadrados: 4.093889236450195
Iteración 18500, Suma cuadrados: 4.7867608070373535
Iteración 18600, Suma cuadrados: 4.097292900085449
Iteración 18700, Suma cuadrados: 4.626296043395996
Iteración 18800, Suma cuadrados: 4.167498588562012
Iteración 18900, Suma cuadrados: 5.856185436248779
Iteración 19000, Suma cuadrados: 4.079311847686768
Iteración 19100, Suma cuadrados: 9.900836944580078
Iteración 19200, Suma cuadrados: 4.97274923324585
Iteración 19300, Suma cuadrados: 4.190138339996338
Iteración 19400, Suma cuadrados: 4.0751800537109375
Iteración 19500, Suma cuadrados: 5.313701152801514
Iteración 19600, Suma cuadrados: 4.072208404541016
Iteración 19700, Suma cuadrados: 8.854387283325195
Iteración 19800, Suma cuadrados: 4.472643852233887
Iteración 19900, Suma cuadrados: 4.454446792602539
Iteración 20000, Suma cuadrados: 4.780727386474609
Iteración 20100, Suma cuadrados: 4.2121148109436035
Iteración 20200, Suma cuadrados: 4.067635536193848
Iteración 20300, Suma cuadrados: 5.082885265350342
Iteración 20400, Suma cuadrados: 4.555091857910156
Iteración 20500, Suma cuadrados: 4.940275192260742
Iteración 20600, Suma cuadrados: 5.421708106994629
Iteración 20700, Suma cuadrados: 4.050044059753418
Iteración 20800, Suma cuadrados: 4.343541622161865
Iteración 20900, Suma cuadrados: 7.68551778793335
Iteración 21000, Suma cuadrados: 4.170497894287109
Iteración 21100, Suma cuadrados: 4.600713729858398
Iteración 21200, Suma cuadrados: 4.378966331481934
Iteración 21300, Suma cuadrados: 4.20708703994751
Iteración 21400, Suma cuadrados: 5.880369186401367
Iteración 21500, Suma cuadrados: 4.059860706329346
Iteración 21600, Suma cuadrados: 4.196103572845459
Iteración 21700, Suma cuadrados: 4.058696746826172
Iteración 21800, Suma cuadrados: 4.13985538482666
Iteración 21900, Suma cuadrados: 4.187601089477539
Iteración 22000, Suma cuadrados: 4.339480876922607
Iteración 22100, Suma cuadrados: 4.164960861206055
Iteración 22200, Suma cuadrados: 4.6016387939453125
Iteración 22300, Suma cuadrados: 7.169179916381836
Iteración 22400, Suma cuadrados: 5.343267440795898
Iteración 22500, Suma cuadrados: 4.7581787109375
Iteración 22600, Suma cuadrados: 4.140371322631836
Iteración 22700, Suma cuadrados: 4.059388160705566
Iteración 22800, Suma cuadrados: 4.192390441894531
Iteración 22900, Suma cuadrados: 4.94191312789917
Iteración 23000, Suma cuadrados: 4.1551737785339355
Iteración 23100, Suma cuadrados: 4.069222927093506
Iteración 23200, Suma cuadrados: 5.591836929321289
Iteración 23300, Suma cuadrados: 4.134202480316162
Iteración 23400, Suma cuadrados: 4.411377906799316
Iteración 23500, Suma cuadrados: 4.502415180206299
Iteración 23600, Suma cuadrados: 4.908420085906982
Iteración 23700, Suma cuadrados: 4.119803428649902
Iteración 23800, Suma cuadrados: 7.129547119140625
Iteración 23900, Suma cuadrados: 4.695497512817383
Iteración 24000, Suma cuadrados: 5.4070611000061035
Iteración 24100, Suma cuadrados: 6.542568206787109
Iteración 24200, Suma cuadrados: 4.733626842498779
Iteración 24300, Suma cuadrados: 5.578272819519043
Iteración 24400, Suma cuadrados: 4.4180755615234375
Iteración 24500, Suma cuadrados: 5.89174747467041
Iteración 24600, Suma cuadrados: 4.58130407333374
Iteración 24700, Suma cuadrados: 4.404761791229248
Iteración 24800, Suma cuadrados: 4.058867931365967
Iteración 24900, Suma cuadrados: 4.170109748840332
Iteración 25000, Suma cuadrados: 6.572751998901367
Iteración 25100, Suma cuadrados: 4.447794437408447
Iteración 25200, Suma cuadrados: 4.948233604431152
Iteración 25300, Suma cuadrados: 4.970843315124512
Iteración 25400, Suma cuadrados: 5.208209991455078
Iteración 25500, Suma cuadrados: 4.484058380126953
Iteración 25600, Suma cuadrados: 4.1537933349609375
Iteración 25700, Suma cuadrados: 4.0455121994018555
Iteración 25800, Suma cuadrados: 4.0701727867126465
Iteración 25900, Suma cuadrados: 4.050625324249268
Iteración 26000, Suma cuadrados: 5.759308815002441
Iteración 26100, Suma cuadrados: 4.553588390350342
Iteración 26200, Suma cuadrados: 4.4373779296875
Iteración 26300, Suma cuadrados: 4.263930797576904
Iteración 26400, Suma cuadrados: 5.449954509735107
Iteración 26500, Suma cuadrados: 4.114926338195801
Iteración 26600, Suma cuadrados: 4.215481758117676
Iteración 26700, Suma cuadrados: 4.623934745788574
Iteración 26800, Suma cuadrados: 9.611564636230469
Iteración 26900, Suma cuadrados: 13.1351318359375
Iteración 27000, Suma cuadrados: 5.088671684265137
Iteración 27100, Suma cuadrados: 4.084439277648926
Iteración 27200, Suma cuadrados: 4.108346939086914
Iteración 27300, Suma cuadrados: 6.93508768081665
Iteración 27400, Suma cuadrados: 4.397321701049805
Iteración 27500, Suma cuadrados: 4.053285598754883
Iteración 27600, Suma cuadrados: 4.6691999435424805
Iteración 27700, Suma cuadrados: 4.287134647369385
Iteración 27800, Suma cuadrados: 4.231245994567871
Iteración 27900, Suma cuadrados: 4.058831214904785
Iteración 28000, Suma cuadrados: 5.806825637817383
Iteración 28100, Suma cuadrados: 5.941788673400879
Iteración 28200, Suma cuadrados: 9.367290496826172
Iteración 28300, Suma cuadrados: 5.442954063415527
Iteración 28400, Suma cuadrados: 4.472907543182373
Iteración 28500, Suma cuadrados: 4.532450199127197
Iteración 28600, Suma cuadrados: 4.1276702880859375
Iteración 28700, Suma cuadrados: 4.090008735656738
Iteración 28800, Suma cuadrados: 4.052028656005859
Iteración 28900, Suma cuadrados: 4.384111404418945
Iteración 29000, Suma cuadrados: 4.755672931671143
Iteración 29100, Suma cuadrados: 4.0585856437683105
Iteración 29200, Suma cuadrados: 8.51402473449707
Iteración 29300, Suma cuadrados: 4.990051746368408
Iteración 29400, Suma cuadrados: 4.056412696838379
Iteración 29500, Suma cuadrados: 7.491554260253906
Iteración 29600, Suma cuadrados: 4.52838134765625
Iteración 29700, Suma cuadrados: 5.4314045906066895
Iteración 29800, Suma cuadrados: 4.546317100524902
Iteración 29900, Suma cuadrados: 4.44674015045166
Parámetros optimizados: [2.0014644  0.49827138 1.         1.        ]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="22_descenso_de_gradiente_files/figure-html/cell-27-output-2.png" width="576" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tareas" class="level1">
<h1>¡Tareas!</h1>
<section id="tarea-11.1" class="level2">
<h2 class="anchored" data-anchor-id="tarea-11.1">Tarea 11.1</h2>
<p>Considere la función <span class="math inline">\(y_{\theta}(x) = (\theta x)^2\)</span>.</p>
<p>Generamos datos ficticios con el siguiente código:</p>
<div id="b8ef1093" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>x_data <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">30</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> (x_data<span class="op">/</span><span class="dv">2</span>)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>y_data <span class="op">=</span> y_true <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.2</span>, size<span class="op">=</span>x_data.shape)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Realice un descenso de gradiente para ajustar el valor de <span class="math inline">\(\theta\)</span> empezando desde el punto <span class="math inline">\(\theta = 1\)</span> y de nuevo desde el punto <span class="math inline">\(\theta = -1\)</span>. Explique la diferencia entre los resultados.</p>
</section>
<section id="tarea-11.2" class="level2">
<h2 class="anchored" data-anchor-id="tarea-11.2">Tarea 11.2</h2>
<p>Considere la función <span class="math inline">\(y_{\theta}(x) = \cos(\theta x)\)</span>.</p>
<p>Generamos datos ficticios con el siguiente código:</p>
<div id="d881cebd" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>x_data <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> np.cos(<span class="dv">2</span><span class="op">*</span>x_data)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>y_data <span class="op">=</span> y_true <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.2</span>, size<span class="op">=</span>x_data.shape)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Intente encontrar el valor de <span class="math inline">\(\theta\)</span> ajustando los datos con mínimos cuadrados y descenso de gradiente partiendo del punto <span class="math inline">\(\theta=-1\)</span>.</p>
<p>Grafique la función de pérdida y explique el origen de la dificultad.</p>
</section>
<section id="tarea-11.3" class="level2">
<h2 class="anchored" data-anchor-id="tarea-11.3">Tarea 11.3</h2>
<p>Para un cierto sistema el volumen está dado por <span class="math display">\[
V(\theta_1, \theta_2) = \sinh(\theta_1^4 + \theta_2^2) - 1\,,
\]</span> donde <span class="math inline">\(\theta_1, \theta_2 \geq 0\)</span>.</p>
<p>Encuentre los valores de los parámetros para los cuales el volumen es mínimo.</p>
</section>
<section id="tarea-11.4" class="level2">
<h2 class="anchored" data-anchor-id="tarea-11.4">Tarea 11.4</h2>
<p>Considere la función <span class="math inline">\(y_{\theta}(x) = (\theta x)^2 + 50\theta x\)</span>.</p>
<p>Generamos datos ficticios con el siguiente código:</p>
<div id="7791cf7d" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>x_data <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">30</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> (x_data<span class="op">/</span><span class="dv">2</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x_data<span class="op">/</span><span class="dv">2</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>y_data <span class="op">=</span> y_true <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.2</span>, size<span class="op">=</span>x_data.shape)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Realice un descenso de gradiente para ajustar el valor de <span class="math inline">\(\theta\)</span> empezando desde el punto <span class="math inline">\(\theta = 2\)</span> y de nuevo desde el punto <span class="math inline">\(\theta = -9\)</span>. Explique la diferencia entre los resultados.</p>
</section>
<section id="tarea-11.5" class="level2">
<h2 class="anchored" data-anchor-id="tarea-11.5">Tarea 11.5</h2>
<p>Considere la función <span class="math inline">\(y_{\theta}(x) = (\theta_0 x)^2 + (\theta_1x)^{-3}\)</span>.</p>
<p>Generamos datos ficticios con el siguiente código:</p>
<div id="b6286837" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>x_data <span class="op">=</span> np.linspace(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">30</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> (x_data<span class="op">/</span><span class="dv">2</span>)<span class="op">**-</span><span class="dv">3</span> <span class="op">+</span> x_data<span class="op">**</span><span class="dv">2</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>y_data <span class="op">=</span> y_true <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.2</span>, size<span class="op">=</span>x_data.shape)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Realice un descenso de gradiente con varios métodos (gradiente sencillo y Adam) y explique la diferencia.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jorgenorena\.github\.io\/metodos-numericos-sitio\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>